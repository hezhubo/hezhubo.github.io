<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>android多媒体播放器之VideoView | Hezb&#39;s blog | android程序猿</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="音视频,多媒体,videoview">
    <meta name="description" content="在需要播放视频的时候，我们会往往会直接使用VideoView，因为方便，简单几行代码就搞定了。 12345VideoView videoView; &#x2F;&#x2F; 通过xml资源或是使用代码自行创建MediaController mediaController &#x3D; new MediaController(this); &#x2F;&#x2F; 封装了播放控制的一个布局（包含播放&#x2F;暂停，时长显示，进度条等），this 上下文v">
<meta property="og:type" content="article">
<meta property="og:title" content="android多媒体播放器之VideoView">
<meta property="og:url" content="http://hezhubo.github.io/2016/08/28/android-videoview/index.html">
<meta property="og:site_name" content="Hezb&#39;s blog">
<meta property="og:description" content="在需要播放视频的时候，我们会往往会直接使用VideoView，因为方便，简单几行代码就搞定了。 12345VideoView videoView; &#x2F;&#x2F; 通过xml资源或是使用代码自行创建MediaController mediaController &#x3D; new MediaController(this); &#x2F;&#x2F; 封装了播放控制的一个布局（包含播放&#x2F;暂停，时长显示，进度条等），this 上下文v">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2016-08-28T04:26:39.000Z">
<meta property="article:modified_time" content="2022-06-01T06:28:52.493Z">
<meta property="article:author" content="Hezb">
<meta property="article:tag" content="音视频">
<meta property="article:tag" content="多媒体">
<meta property="article:tag" content="videoview">
<meta name="twitter:card" content="summary">
    
        <link rel="alternate" type="application/atom+xml" title="Hezb&#39;s blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 6.2.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Hezb</h5>
          <a href="mailto:526125686@qq.com" title="526125686@qq.com" class="mail">526125686@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/hezhubo" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">android多媒体播放器之VideoView</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">android多媒体播放器之VideoView</h1>
        <h5 class="subtitle">
            
                <time datetime="2016-08-28T04:26:39.000Z" itemprop="datePublished" class="page-time">
  2016-08-28
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/">Android</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%9F%BA%E4%BA%8EAPI-23%E7%9A%84%E4%B8%BB%E8%A6%81%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%EF%BC%9A"><span class="post-toc-text">基于API 23的主要源码分析：</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E7%BB%93%E6%9E%84%E5%85%B3%E7%B3%BB"><span class="post-toc-text">结构关系</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E6%88%90%E5%91%98%E5%8F%98%E9%87%8F"><span class="post-toc-text">成员变量</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%96%B9%E6%B3%95"><span class="post-toc-text">初始化方法</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#SurfaceView%E6%B5%8B%E9%87%8F%E9%83%A8%E5%88%86"><span class="post-toc-text">SurfaceView测量部分</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%86%85%E9%83%A8%E7%9B%91%E5%90%AC%E5%99%A8"><span class="post-toc-text">内部监听器</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E8%A7%86%E9%A2%91%E5%B0%BA%E5%AF%B8%E5%8F%98%E5%8C%96%E7%9B%91%E5%90%AC%E5%99%A8"><span class="post-toc-text">视频尺寸变化监听器</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E8%A7%86%E9%A2%91%E9%A2%84%E5%A4%84%E7%90%86%E7%9B%91%E5%90%AC%E5%99%A8"><span class="post-toc-text">视频预处理监听器</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE%E5%AE%8C%E6%88%90%E7%9B%91%E5%90%AC%E5%99%A8"><span class="post-toc-text">视频播放完成监听器</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE-%E8%BF%87%E7%A8%8B-%E4%BF%A1%E6%81%AF%E7%9B%91%E5%90%AC%E5%99%A8"><span class="post-toc-text">视频播放(过程)信息监听器</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE%E9%94%99%E8%AF%AF%E7%9B%91%E5%90%AC%E5%99%A8"><span class="post-toc-text">视频播放错误监听器</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E8%A7%86%E9%A2%91%E7%BC%93%E5%86%B2%E7%9B%91%E5%90%AC%E5%99%A8"><span class="post-toc-text">视频缓冲监听器</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E8%A7%A6%E7%A2%B0%E5%8F%8A%E9%94%AE%E7%9B%98%E4%BA%8B%E4%BB%B6"><span class="post-toc-text">触碰及键盘事件</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%B8%BB%E8%A6%81%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95"><span class="post-toc-text">主要操作方法</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%A7%86%E9%A2%91%E6%BA%90%E8%B7%AF%E5%BE%84"><span class="post-toc-text">设置视频源路径</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E6%92%AD%E6%94%BE"><span class="post-toc-text">播放</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E6%9A%82%E5%81%9C"><span class="post-toc-text">暂停</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E6%8C%82%E8%B5%B7%E6%92%AD%E6%94%BE%E5%99%A8"><span class="post-toc-text">挂起播放器</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E6%81%A2%E5%A4%8D%E6%92%AD%E6%94%BE%E5%99%A8"><span class="post-toc-text">恢复播放器</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95"><span class="post-toc-text">其他方法</span></a></li></ol></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-android-videoview"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">android多媒体播放器之VideoView</h1>
        <div class="post-meta">
            <time class="post-time" title="2016-08-28 12:26:39" datetime="2016-08-28T04:26:39.000Z"  itemprop="datePublished">2016-08-28</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/">Android</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <blockquote>
<p>在需要播放视频的时候，我们会往往会直接使用VideoView，因为方便，简单几行代码就搞定了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">VideoView videoView; <span class="comment">// 通过xml资源或是使用代码自行创建</span></span><br><span class="line"><span class="type">MediaController</span> <span class="variable">mediaController</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MediaController</span>(<span class="built_in">this</span>); <span class="comment">// 封装了播放控制的一个布局（包含播放/暂停，时长显示，进度条等），this 上下文</span></span><br><span class="line">videoView.setMediaController(mediaController); <span class="comment">// 设置控制器</span></span><br><span class="line">videoView.setVideoPath(<span class="string">&quot;/mnt/sdcard/test.mp4&quot;</span>); <span class="comment">// 视频路径，支持本地文件，http，rtsp协议</span></span><br><span class="line">videoView.start(); <span class="comment">// 开始播放</span></span><br></pre></td></tr></table></figure>
<p><strong>VideoView其实是SurfaceView+MediaPlayer的封装，下面来分析一下源码的实现。</strong></p>
</blockquote>
<h3 id="基于API-23的主要源码分析："><a href="#基于API-23的主要源码分析：" class="headerlink" title="基于API 23的主要源码分析："></a>基于API 23的主要源码分析：</h3><h4 id="结构关系"><a href="#结构关系" class="headerlink" title="结构关系"></a>结构关系</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VideoView</span> <span class="keyword">extends</span> <span class="title class_">SurfaceView</span> <span class="keyword">implements</span> <span class="title class_">MediaPlayerControl</span>, SubtitleController.Anchor &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到VideoView继承SurfaceView，实现了两接口：MediaPlayerControl和SubtitleController.Anchor。MediaPlayerControl就是android.widget.MediaController的内部接口，MediaController就是通过这个接口来控制播放器的。至于SubtitleController.Anchor这个接口是和字幕有关的，具体怎么用我暂时不清楚。<br>下面看一下MediaPlayerControl的源码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MediaPlayerControl</span> &#123;</span><br><span class="line">    <span class="keyword">void</span>    <span class="title function_">start</span><span class="params">()</span>; <span class="comment">// 播放</span></span><br><span class="line">    <span class="keyword">void</span>    <span class="title function_">pause</span><span class="params">()</span>; <span class="comment">// 暂停</span></span><br><span class="line">    <span class="type">int</span>     <span class="title function_">getDuration</span><span class="params">()</span>; <span class="comment">// 获取总时长</span></span><br><span class="line">    <span class="type">int</span>     <span class="title function_">getCurrentPosition</span><span class="params">()</span>; <span class="comment">// 获取当前播放位置</span></span><br><span class="line">    <span class="keyword">void</span>    <span class="title function_">seekTo</span><span class="params">(<span class="type">int</span> pos)</span>; <span class="comment">// 跳转到指定位置</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isPlaying</span><span class="params">()</span>; <span class="comment">// 是否在播放</span></span><br><span class="line">    <span class="type">int</span>     <span class="title function_">getBufferPercentage</span><span class="params">()</span>; <span class="comment">// 获取总缓冲百分比</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">canPause</span><span class="params">()</span>; <span class="comment">// 能否暂停</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">canSeekBackward</span><span class="params">()</span>; <span class="comment">// 能否向后跳转</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">canSeekForward</span><span class="params">()</span>; <span class="comment">// 能否向前跳转</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get the audio session id for the player used by this VideoView. This can be used to</span></span><br><span class="line"><span class="comment">     * apply audio effects to the audio track of a video.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> The audio session, or 0 if there was an error.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span>     <span class="title function_">getAudioSessionId</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="成员变量"><a href="#成员变量" class="headerlink" title="成员变量"></a>成员变量</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// settable by the client</span></span><br><span class="line"><span class="keyword">private</span> Uri         mUri; <span class="comment">// 视频的Uri</span></span><br><span class="line"><span class="keyword">private</span> Map&lt;String, String&gt; mHeaders; <span class="comment">// 请求头</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 所有有可能的播放状态</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">STATE_ERROR</span>              <span class="operator">=</span> -<span class="number">1</span>; <span class="comment">// 错误</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">STATE_IDLE</span>               <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// 初始</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">STATE_PREPARING</span>          <span class="operator">=</span> <span class="number">1</span>; <span class="comment">// 预处理中</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">STATE_PREPARED</span>           <span class="operator">=</span> <span class="number">2</span>; <span class="comment">// 预处理完成</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">STATE_PLAYING</span>            <span class="operator">=</span> <span class="number">3</span>; <span class="comment">// 播放中</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">STATE_PAUSED</span>             <span class="operator">=</span> <span class="number">4</span>; <span class="comment">// 暂停</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">STATE_PLAYBACK_COMPLETED</span> <span class="operator">=</span> <span class="number">5</span>; <span class="comment">// 播放完成</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">mCurrentState</span> <span class="operator">=</span> STATE_IDLE; <span class="comment">// 当前状态</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="variable">mTargetState</span>  <span class="operator">=</span> STATE_IDLE; <span class="comment">// 目标状态</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// All the stuff we need for playing and showing a video</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">SurfaceHolder</span> <span class="variable">mSurfaceHolder</span> <span class="operator">=</span> <span class="literal">null</span>; <span class="comment">// Surface持有者</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">MediaPlayer</span> <span class="variable">mMediaPlayer</span> <span class="operator">=</span> <span class="literal">null</span>; <span class="comment">// 真正的播放器</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span>         mAudioSession; <span class="comment">// 音频 Session id</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span>         mVideoWidth; <span class="comment">// 视频宽</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span>         mVideoHeight; <span class="comment">// 视频高</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span>         mSurfaceWidth; <span class="comment">// 显示(绘制)宽</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span>         mSurfaceHeight; <span class="comment">// 显示(绘制)高</span></span><br><span class="line"><span class="keyword">private</span> MediaController mMediaController; <span class="comment">// 控制层控制器</span></span><br><span class="line"><span class="keyword">private</span> OnCompletionListener mOnCompletionListener; <span class="comment">// 播放完成监听器</span></span><br><span class="line"><span class="keyword">private</span> MediaPlayer.OnPreparedListener mOnPreparedListener; <span class="comment">// 预处理监听器</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span>         mCurrentBufferPercentage; <span class="comment">// 当前缓冲百分比 </span></span><br><span class="line"><span class="keyword">private</span> OnErrorListener mOnErrorListener; <span class="comment">// 错误监听器</span></span><br><span class="line"><span class="keyword">private</span> OnInfoListener  mOnInfoListener; <span class="comment">// 播放(过程)信息监听器</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span>         mSeekWhenPrepared;  <span class="comment">// 预处理完成跳转位置</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span>     mCanPause; <span class="comment">// 能否暂停</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span>     mCanSeekBack; <span class="comment">// 能否向后跳转</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span>     mCanSeekForward; <span class="comment">// 能否向前跳转</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** Subtitle rendering widget overlaid on top of the video. */</span></span><br><span class="line"><span class="keyword">private</span> RenderingWidget mSubtitleWidget; <span class="comment">// 字幕渲染组件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** Listener for changes to subtitle data, used to redraw when needed. */</span></span><br><span class="line"><span class="keyword">private</span> RenderingWidget.OnChangedListener mSubtitlesChangedListener;</span><br></pre></td></tr></table></figure>

<h4 id="初始化方法"><a href="#初始化方法" class="headerlink" title="初始化方法"></a>初始化方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">initVideoView</span><span class="params">()</span> &#123;</span><br><span class="line">    mVideoWidth = <span class="number">0</span>;</span><br><span class="line">    mVideoHeight = <span class="number">0</span>;</span><br><span class="line">    getHolder().addCallback(mSHCallback); <span class="comment">// 给Holder添加回调</span></span><br><span class="line">    getHolder().setType(SurfaceHolder.SURFACE_TYPE_PUSH_BUFFERS); <span class="comment">// 这个可以不设置</span></span><br><span class="line">    setFocusable(<span class="literal">true</span>); <span class="comment">// 设置可以获取焦点</span></span><br><span class="line">    setFocusableInTouchMode(<span class="literal">true</span>); <span class="comment">// 设置触摸可以获取焦点</span></span><br><span class="line">    requestFocus(); <span class="comment">// 请求焦点</span></span><br><span class="line">    mPendingSubtitleTracks = <span class="keyword">new</span> <span class="title class_">Vector</span>&lt;Pair&lt;InputStream, MediaFormat&gt;&gt;(); <span class="comment">// 字幕相关 字幕轨道表</span></span><br><span class="line">    <span class="comment">// 当前状态与目标状态均为初始状态</span></span><br><span class="line">    mCurrentState = STATE_IDLE;</span><br><span class="line">    mTargetState  = STATE_IDLE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中mSHCallback代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">SurfaceHolder.<span class="type">Callback</span> <span class="variable">mSHCallback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SurfaceHolder</span>.Callback()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">surfaceChanged</span><span class="params">(SurfaceHolder holder, <span class="type">int</span> format,</span></span><br><span class="line"><span class="params">                                <span class="type">int</span> w, <span class="type">int</span> h)</span></span><br><span class="line">    &#123; <span class="comment">// 在surface发生改变时回调此方法</span></span><br><span class="line">        mSurfaceWidth = w; <span class="comment">// 设置surface宽</span></span><br><span class="line">        mSurfaceHeight = h; <span class="comment">// 设置surface高</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isValidState</span> <span class="operator">=</span>  (mTargetState == STATE_PLAYING); <span class="comment">// 若目标状态是播放状态，则记为有效状态</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">hasValidSize</span> <span class="operator">=</span> (mVideoWidth == w &amp;&amp; mVideoHeight == h); <span class="comment">// 若视频宽高与surface宽高一致，则记为有效尺寸</span></span><br><span class="line">        <span class="keyword">if</span> (mMediaPlayer != <span class="literal">null</span> &amp;&amp; isValidState &amp;&amp; hasValidSize) &#123; <span class="comment">// 播放器可用，并且状态与尺寸均有效，则开始播放</span></span><br><span class="line">            <span class="keyword">if</span> (mSeekWhenPrepared != <span class="number">0</span>) &#123; <span class="comment">// 这是播放前检查是否要跳转</span></span><br><span class="line">                seekTo(mSeekWhenPrepared); <span class="comment">// 跳转到指定位置</span></span><br><span class="line">            &#125;</span><br><span class="line">            start(); <span class="comment">// 开始播放</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">surfaceCreated</span><span class="params">(SurfaceHolder holder)</span></span><br><span class="line">    &#123; <span class="comment">// 在surface创建时回调此方法</span></span><br><span class="line">        mSurfaceHolder = holder;</span><br><span class="line">        openVideo(); <span class="comment">// 打开播放器</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">surfaceDestroyed</span><span class="params">(SurfaceHolder holder)</span></span><br><span class="line">    &#123; <span class="comment">// 在surface销毁时回调此方法，一旦销毁就不能再使用</span></span><br><span class="line">        mSurfaceHolder = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (mMediaController != <span class="literal">null</span>) mMediaController.hide(); <span class="comment">// 隐藏控制层</span></span><br><span class="line">        release(<span class="literal">true</span>); <span class="comment">// 释放资源</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="SurfaceView测量部分"><a href="#SurfaceView测量部分" class="headerlink" title="SurfaceView测量部分"></a>SurfaceView测量部分</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onMeasure</span><span class="params">(<span class="type">int</span> widthMeasureSpec, <span class="type">int</span> heightMeasureSpec)</span> &#123; <span class="comment">// 测量宽高</span></span><br><span class="line">    <span class="comment">// 根据视频尺寸和布局宽高计算宽高</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">width</span> <span class="operator">=</span> getDefaultSize(mVideoWidth, widthMeasureSpec);</span><br><span class="line">    <span class="type">int</span> <span class="variable">height</span> <span class="operator">=</span> getDefaultSize(mVideoHeight, heightMeasureSpec);</span><br><span class="line">    <span class="keyword">if</span> (mVideoWidth &gt; <span class="number">0</span> &amp;&amp; mVideoHeight &gt; <span class="number">0</span>) &#123; <span class="comment">// 当视频宽高可用时</span></span><br><span class="line">        <span class="comment">// 计算布局设定的大小</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">widthSpecMode</span> <span class="operator">=</span> MeasureSpec.getMode(widthMeasureSpec);</span><br><span class="line">        <span class="type">int</span> <span class="variable">widthSpecSize</span> <span class="operator">=</span> MeasureSpec.getSize(widthMeasureSpec);</span><br><span class="line">        <span class="type">int</span> <span class="variable">heightSpecMode</span> <span class="operator">=</span> MeasureSpec.getMode(heightMeasureSpec);</span><br><span class="line">        <span class="type">int</span> <span class="variable">heightSpecSize</span> <span class="operator">=</span> MeasureSpec.getSize(heightMeasureSpec);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 下列条件父布局宽高是否限定子布局宽高</span></span><br><span class="line">        <span class="keyword">if</span> (widthSpecMode == MeasureSpec.EXACTLY &amp;&amp; heightSpecMode == MeasureSpec.EXACTLY) &#123;</span><br><span class="line">            <span class="comment">// the size is fixed</span></span><br><span class="line">            width = widthSpecSize;</span><br><span class="line">            height = heightSpecSize;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// for compatibility, we adjust size based on aspect ratio</span></span><br><span class="line">            <span class="keyword">if</span> ( mVideoWidth * height  &lt; width * mVideoHeight ) &#123;</span><br><span class="line">                <span class="comment">//Log.i(&quot;@@@&quot;, &quot;image too wide, correcting&quot;);</span></span><br><span class="line">                width = height * mVideoWidth / mVideoHeight;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( mVideoWidth * height  &gt; width * mVideoHeight ) &#123;</span><br><span class="line">                <span class="comment">//Log.i(&quot;@@@&quot;, &quot;image too tall, correcting&quot;);</span></span><br><span class="line">                height = width * mVideoHeight / mVideoWidth;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (widthSpecMode == MeasureSpec.EXACTLY) &#123;</span><br><span class="line">            <span class="comment">// only the width is fixed, adjust the height to match aspect ratio if possible</span></span><br><span class="line">            width = widthSpecSize;</span><br><span class="line">            height = width * mVideoHeight / mVideoWidth;</span><br><span class="line">            <span class="keyword">if</span> (heightSpecMode == MeasureSpec.AT_MOST &amp;&amp; height &gt; heightSpecSize) &#123;</span><br><span class="line">                <span class="comment">// couldn&#x27;t match aspect ratio within the constraints</span></span><br><span class="line">                height = heightSpecSize;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (heightSpecMode == MeasureSpec.EXACTLY) &#123;</span><br><span class="line">            <span class="comment">// only the height is fixed, adjust the width to match aspect ratio if possible</span></span><br><span class="line">            height = heightSpecSize;</span><br><span class="line">            width = height * mVideoWidth / mVideoHeight;</span><br><span class="line">            <span class="keyword">if</span> (widthSpecMode == MeasureSpec.AT_MOST &amp;&amp; width &gt; widthSpecSize) &#123;</span><br><span class="line">                <span class="comment">// couldn&#x27;t match aspect ratio within the constraints</span></span><br><span class="line">                width = widthSpecSize;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// neither the width nor the height are fixed, try to use actual video size</span></span><br><span class="line">            width = mVideoWidth;</span><br><span class="line">            height = mVideoHeight;</span><br><span class="line">            <span class="keyword">if</span> (heightSpecMode == MeasureSpec.AT_MOST &amp;&amp; height &gt; heightSpecSize) &#123;</span><br><span class="line">                <span class="comment">// too tall, decrease both width and height</span></span><br><span class="line">                height = heightSpecSize;</span><br><span class="line">                width = height * mVideoWidth / mVideoHeight;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (widthSpecMode == MeasureSpec.AT_MOST &amp;&amp; width &gt; widthSpecSize) &#123;</span><br><span class="line">                <span class="comment">// too wide, decrease both width and height</span></span><br><span class="line">                width = widthSpecSize;</span><br><span class="line">                height = width * mVideoHeight / mVideoWidth;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// no size yet, just adopt the given spec sizes</span></span><br><span class="line">    &#125;</span><br><span class="line">    setMeasuredDimension(width, height); <span class="comment">// 存储测量的宽高</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="内部监听器"><a href="#内部监听器" class="headerlink" title="内部监听器"></a>内部监听器</h4><h5 id="视频尺寸变化监听器"><a href="#视频尺寸变化监听器" class="headerlink" title="视频尺寸变化监听器"></a>视频尺寸变化监听器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">MediaPlayer.<span class="type">OnVideoSizeChangedListener</span> <span class="variable">mSizeChangedListener</span> <span class="operator">=</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MediaPlayer</span>.OnVideoSizeChangedListener() &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onVideoSizeChanged</span><span class="params">(MediaPlayer mp, <span class="type">int</span> width, <span class="type">int</span> height)</span> &#123;</span><br><span class="line">            mVideoWidth = mp.getVideoWidth();</span><br><span class="line">            mVideoHeight = mp.getVideoHeight();</span><br><span class="line">            <span class="keyword">if</span> (mVideoWidth != <span class="number">0</span> &amp;&amp; mVideoHeight != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// 设置surface固定尺寸</span></span><br><span class="line">                getHolder().setFixedSize(mVideoWidth, mVideoHeight);</span><br><span class="line">                requestLayout(); <span class="comment">// 请求重新测量布局</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="视频预处理监听器"><a href="#视频预处理监听器" class="headerlink" title="视频预处理监听器"></a>视频预处理监听器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">MediaPlayer.<span class="type">OnPreparedListener</span> <span class="variable">mPreparedListener</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MediaPlayer</span>.OnPreparedListener() &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPrepared</span><span class="params">(MediaPlayer mp)</span> &#123;</span><br><span class="line">        mCurrentState = STATE_PREPARED; <span class="comment">// 当前状态已预处理完成</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get the capabilities of the player for this stream</span></span><br><span class="line">        <span class="type">Metadata</span> <span class="variable">data</span> <span class="operator">=</span> mp.getMetadata(MediaPlayer.METADATA_ALL,</span><br><span class="line">                                  MediaPlayer.BYPASS_METADATA_FILTER);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (data != <span class="literal">null</span>) &#123; <span class="comment">// 解析获取的视频信息</span></span><br><span class="line">            mCanPause = !data.has(Metadata.PAUSE_AVAILABLE)</span><br><span class="line">                    || data.getBoolean(Metadata.PAUSE_AVAILABLE);</span><br><span class="line">            mCanSeekBack = !data.has(Metadata.SEEK_BACKWARD_AVAILABLE)</span><br><span class="line">                    || data.getBoolean(Metadata.SEEK_BACKWARD_AVAILABLE);</span><br><span class="line">            mCanSeekForward = !data.has(Metadata.SEEK_FORWARD_AVAILABLE)</span><br><span class="line">                    || data.getBoolean(Metadata.SEEK_FORWARD_AVAILABLE);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 视频信息获取失败，下面操作默认都可以</span></span><br><span class="line">            mCanPause = mCanSeekBack = mCanSeekForward = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mOnPreparedListener != <span class="literal">null</span>) &#123;</span><br><span class="line">            mOnPreparedListener.onPrepared(mMediaPlayer); <span class="comment">// 告诉外部的监听器</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mMediaController != <span class="literal">null</span>) &#123;</span><br><span class="line">            mMediaController.setEnabled(<span class="literal">true</span>); <span class="comment">// 当前控制器可用</span></span><br><span class="line">        &#125;</span><br><span class="line">        mVideoWidth = mp.getVideoWidth();</span><br><span class="line">        mVideoHeight = mp.getVideoHeight();</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">seekToPosition</span> <span class="operator">=</span> mSeekWhenPrepared;  <span class="comment">// mSeekWhenPrepared may be changed after seekTo() call</span></span><br><span class="line">        <span class="keyword">if</span> (seekToPosition != <span class="number">0</span>) &#123;</span><br><span class="line">            seekTo(seekToPosition); <span class="comment">// 跳转到指定位置</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mVideoWidth != <span class="number">0</span> &amp;&amp; mVideoHeight != <span class="number">0</span>) &#123;</span><br><span class="line">            getHolder().setFixedSize(mVideoWidth, mVideoHeight); <span class="comment">// 设置surface固定尺寸</span></span><br><span class="line">            <span class="keyword">if</span> (mSurfaceWidth == mVideoWidth &amp;&amp; mSurfaceHeight == mVideoHeight) &#123;</span><br><span class="line">                <span class="comment">// We didn&#x27;t actually change the size (it was already at the size</span></span><br><span class="line">                <span class="comment">// we need), so we won&#x27;t get a &quot;surface changed&quot; callback, so</span></span><br><span class="line">                <span class="comment">// start the video here instead of in the callback.</span></span><br><span class="line">                <span class="keyword">if</span> (mTargetState == STATE_PLAYING) &#123; <span class="comment">// 当目标状态为播放状态时</span></span><br><span class="line">                    start(); <span class="comment">// 开始播放</span></span><br><span class="line">                    <span class="keyword">if</span> (mMediaController != <span class="literal">null</span>) &#123;</span><br><span class="line">                        mMediaController.show(); <span class="comment">// 展示控制器UI</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!isPlaying() &amp;&amp;</span><br><span class="line">                           (seekToPosition != <span class="number">0</span> || getCurrentPosition() &gt; <span class="number">0</span>)) &#123;</span><br><span class="line">                   <span class="comment">// 不是在播放状态并且当前进度不为0时，展示控制器UI</span></span><br><span class="line">                   <span class="keyword">if</span> (mMediaController != <span class="literal">null</span>) &#123;</span><br><span class="line">                       <span class="comment">// Show the media controls when we&#x27;re paused into a video and make &#x27;em stick.</span></span><br><span class="line">                       mMediaController.show(<span class="number">0</span>);</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// We don&#x27;t know the video size yet, but should start anyway.</span></span><br><span class="line">            <span class="comment">// The video size might be reported to us later.</span></span><br><span class="line">            <span class="keyword">if</span> (mTargetState == STATE_PLAYING) &#123; <span class="comment">// 当目标状态为播放状态时</span></span><br><span class="line">                start(); <span class="comment">// 开始播放</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="视频播放完成监听器"><a href="#视频播放完成监听器" class="headerlink" title="视频播放完成监听器"></a>视频播放完成监听器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> MediaPlayer.<span class="type">OnCompletionListener</span> <span class="variable">mCompletionListener</span> <span class="operator">=</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MediaPlayer</span>.OnCompletionListener() &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCompletion</span><span class="params">(MediaPlayer mp)</span> &#123;</span><br><span class="line">        <span class="comment">// 当前状态与目标状态为播放完成状态</span></span><br><span class="line">        mCurrentState = STATE_PLAYBACK_COMPLETED;</span><br><span class="line">        mTargetState = STATE_PLAYBACK_COMPLETED;</span><br><span class="line">        <span class="keyword">if</span> (mMediaController != <span class="literal">null</span>) &#123;</span><br><span class="line">            mMediaController.hide(); <span class="comment">// 隐藏控制层</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mOnCompletionListener != <span class="literal">null</span>) &#123;</span><br><span class="line">            mOnCompletionListener.onCompletion(mMediaPlayer); <span class="comment">// 通知外部的监听器</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="视频播放-过程-信息监听器"><a href="#视频播放-过程-信息监听器" class="headerlink" title="视频播放(过程)信息监听器"></a>视频播放(过程)信息监听器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> MediaPlayer.<span class="type">OnInfoListener</span> <span class="variable">mInfoListener</span> <span class="operator">=</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MediaPlayer</span>.OnInfoListener() &#123;</span><br><span class="line">    <span class="keyword">public</span>  <span class="type">boolean</span> <span class="title function_">onInfo</span><span class="params">(MediaPlayer mp, <span class="type">int</span> arg1, <span class="type">int</span> arg2)</span> &#123;</span><br><span class="line">        <span class="comment">// 这里没做任何处理，直接通知外部的监听器</span></span><br><span class="line">        <span class="keyword">if</span> (mOnInfoListener != <span class="literal">null</span>) &#123;</span><br><span class="line">            mOnInfoListener.onInfo(mp, arg1, arg2);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="视频播放错误监听器"><a href="#视频播放错误监听器" class="headerlink" title="视频播放错误监听器"></a>视频播放错误监听器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> MediaPlayer.<span class="type">OnErrorListener</span> <span class="variable">mErrorListener</span> <span class="operator">=</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MediaPlayer</span>.OnErrorListener() &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onError</span><span class="params">(MediaPlayer mp, <span class="type">int</span> framework_err, <span class="type">int</span> impl_err)</span> &#123;</span><br><span class="line">        Log.d(TAG, <span class="string">&quot;Error: &quot;</span> + framework_err + <span class="string">&quot;,&quot;</span> + impl_err);</span><br><span class="line">        <span class="comment">// 当前状态与目标状态为错误状态</span></span><br><span class="line">        mCurrentState = STATE_ERROR;</span><br><span class="line">        mTargetState = STATE_ERROR;</span><br><span class="line">        <span class="keyword">if</span> (mMediaController != <span class="literal">null</span>) &#123;</span><br><span class="line">            mMediaController.hide(); <span class="comment">// 隐藏控制层UI</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* If an error handler has been supplied, use it and finish. */</span></span><br><span class="line">        <span class="keyword">if</span> (mOnErrorListener != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mOnErrorListener.onError(mMediaPlayer, framework_err, impl_err)) &#123;</span><br><span class="line">                <span class="comment">// 通知外部的监听器，又外部来处理错误，不往下执行</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* Otherwise, pop up an error dialog so the user knows that</span></span><br><span class="line"><span class="comment">         * something bad has happened. Only try and pop up the dialog</span></span><br><span class="line"><span class="comment">         * if we&#x27;re attached to a window. When we&#x27;re going away and no</span></span><br><span class="line"><span class="comment">         * longer have a window, don&#x27;t bother showing the user an error.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (getWindowToken() != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">Resources</span> <span class="variable">r</span> <span class="operator">=</span> mContext.getResources();</span><br><span class="line">            <span class="type">int</span> messageId;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (framework_err == MediaPlayer.MEDIA_ERROR_NOT_VALID_FOR_PROGRESSIVE_PLAYBACK) &#123;</span><br><span class="line">                messageId = com.android.internal.R.string.VideoView_error_text_invalid_progressive_playback;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                messageId = com.android.internal.R.string.VideoView_error_text_unknown;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">AlertDialog</span>.Builder(mContext)</span><br><span class="line">                    .setMessage(messageId)</span><br><span class="line">                    .setPositiveButton(com.android.internal.R.string.VideoView_error_button,</span><br><span class="line">                            <span class="keyword">new</span> <span class="title class_">DialogInterface</span>.OnClickListener() &#123;</span><br><span class="line">                                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(DialogInterface dialog, <span class="type">int</span> whichButton)</span> &#123;</span><br><span class="line">                                    <span class="comment">/* If we get here, there is no onError listener, so</span></span><br><span class="line"><span class="comment">                                     * at least inform them that the video is over.</span></span><br><span class="line"><span class="comment">                                     */</span></span><br><span class="line">                                    <span class="keyword">if</span> (mOnCompletionListener != <span class="literal">null</span>) &#123;</span><br><span class="line">                                        mOnCompletionListener.onCompletion(mMediaPlayer);</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;)</span><br><span class="line">                    .setCancelable(<span class="literal">false</span>)</span><br><span class="line">                    .show();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h5 id="视频缓冲监听器"><a href="#视频缓冲监听器" class="headerlink" title="视频缓冲监听器"></a>视频缓冲监听器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> MediaPlayer.<span class="type">OnBufferingUpdateListener</span> <span class="variable">mBufferingUpdateListener</span> <span class="operator">=</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MediaPlayer</span>.OnBufferingUpdateListener() &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onBufferingUpdate</span><span class="params">(MediaPlayer mp, <span class="type">int</span> percent)</span> &#123;</span><br><span class="line">        mCurrentBufferPercentage = percent; <span class="comment">// 记录当前缓冲百分比</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="触碰及键盘事件"><a href="#触碰及键盘事件" class="headerlink" title="触碰及键盘事件"></a>触碰及键盘事件</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onTouchEvent</span><span class="params">(MotionEvent ev)</span> &#123;</span><br><span class="line">    <span class="comment">// 触摸事件</span></span><br><span class="line">    <span class="keyword">if</span> (isInPlaybackState() &amp;&amp; mMediaController != <span class="literal">null</span>) &#123; <span class="comment">// 当前状态为可用状态并且控制器存在</span></span><br><span class="line">        toggleMediaControlsVisiblity(); <span class="comment">// 显示/隐藏控制层UI</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onTrackballEvent</span><span class="params">(MotionEvent ev)</span> &#123;</span><br><span class="line">    <span class="comment">// 轨迹球事件</span></span><br><span class="line">    <span class="keyword">if</span> (isInPlaybackState() &amp;&amp; mMediaController != <span class="literal">null</span>) &#123; <span class="comment">// 当前状态为可用状态并且控制器存在</span></span><br><span class="line">        toggleMediaControlsVisiblity(); <span class="comment">// 显示/隐藏控制层UI</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 判断是否为可用状态</span></span><br><span class="line"><span class="comment"> * 播放器不为空</span></span><br><span class="line"><span class="comment"> * 当前状态不为错误，初始，预处理中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isInPlaybackState</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (mMediaPlayer != <span class="literal">null</span> &amp;&amp;</span><br><span class="line">            mCurrentState != STATE_ERROR &amp;&amp;</span><br><span class="line">            mCurrentState != STATE_IDLE &amp;&amp;</span><br><span class="line">            mCurrentState != STATE_PREPARING);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onKeyDown</span><span class="params">(<span class="type">int</span> keyCode, KeyEvent event)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 主要是用于显示/隐藏控制器UI,以及处理播放暂停</span></span><br><span class="line">    <span class="comment">// 判断按键是否为需要处理的按键</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isKeyCodeSupported</span> <span class="operator">=</span> keyCode != KeyEvent.KEYCODE_BACK &amp;&amp;</span><br><span class="line">                                 keyCode != KeyEvent.KEYCODE_VOLUME_UP &amp;&amp;</span><br><span class="line">                                 keyCode != KeyEvent.KEYCODE_VOLUME_DOWN &amp;&amp;</span><br><span class="line">                                 keyCode != KeyEvent.KEYCODE_VOLUME_MUTE &amp;&amp;</span><br><span class="line">                                 keyCode != KeyEvent.KEYCODE_MENU &amp;&amp;</span><br><span class="line">                                 keyCode != KeyEvent.KEYCODE_CALL &amp;&amp;</span><br><span class="line">                                 keyCode != KeyEvent.KEYCODE_ENDCALL;</span><br><span class="line">    <span class="keyword">if</span> (isInPlaybackState() &amp;&amp; isKeyCodeSupported &amp;&amp; mMediaController != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (keyCode == KeyEvent.KEYCODE_HEADSETHOOK ||</span><br><span class="line">                keyCode == KeyEvent.KEYCODE_MEDIA_PLAY_PAUSE) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mMediaPlayer.isPlaying()) &#123;</span><br><span class="line">                pause();</span><br><span class="line">                mMediaController.show();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                start();</span><br><span class="line">                mMediaController.hide();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (keyCode == KeyEvent.KEYCODE_MEDIA_PLAY) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!mMediaPlayer.isPlaying()) &#123;</span><br><span class="line">                start();</span><br><span class="line">                mMediaController.hide();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (keyCode == KeyEvent.KEYCODE_MEDIA_STOP</span><br><span class="line">                || keyCode == KeyEvent.KEYCODE_MEDIA_PAUSE) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mMediaPlayer.isPlaying()) &#123;</span><br><span class="line">                pause();</span><br><span class="line">                mMediaController.show();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            toggleMediaControlsVisiblity();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.onKeyDown(keyCode, event);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 控制器UI显示与隐藏相互切换</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">toggleMediaControlsVisiblity</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (mMediaController.isShowing()) &#123;</span><br><span class="line">        mMediaController.hide();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        mMediaController.show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="主要操作方法"><a href="#主要操作方法" class="headerlink" title="主要操作方法"></a>主要操作方法</h4><h5 id="设置视频源路径"><a href="#设置视频源路径" class="headerlink" title="设置视频源路径"></a>设置视频源路径</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Sets video path.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> path the path of the video.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVideoPath</span><span class="params">(String path)</span> &#123;</span><br><span class="line">    setVideoURI(Uri.parse(path));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Sets video URI.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> uri the URI of the video.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVideoURI</span><span class="params">(Uri uri)</span> &#123;</span><br><span class="line">    setVideoURI(uri, <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Sets video URI using specific headers.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> uri     the URI of the video.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> headers the headers for the URI request.</span></span><br><span class="line"><span class="comment"> *                Note that the cross domain redirection is allowed by default, but that can be</span></span><br><span class="line"><span class="comment"> *                changed with key/value pairs through the headers parameter with</span></span><br><span class="line"><span class="comment"> *                &quot;android-allow-cross-domain-redirect&quot; as the key and &quot;0&quot; or &quot;1&quot; as the value</span></span><br><span class="line"><span class="comment"> *                to disallow or allow cross domain redirection.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVideoURI</span><span class="params">(Uri uri, Map&lt;String, String&gt; headers)</span> &#123;</span><br><span class="line">    mUri = uri; <span class="comment">// 设置视频的Uri</span></span><br><span class="line">    mHeaders = headers; <span class="comment">// 设置请求头</span></span><br><span class="line">    mSeekWhenPrepared = <span class="number">0</span>; <span class="comment">// 设置预处理完成不跳转</span></span><br><span class="line">    openVideo(); <span class="comment">// 打开播放器并设置相应参数</span></span><br><span class="line">    requestLayout(); <span class="comment">// 请求重新测量布局</span></span><br><span class="line">    invalidate(); <span class="comment">// 请求重绘</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 最重要的方法————开启视频</span></span><br><span class="line"><span class="comment"> * 初始化MediaPlayer及其参数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">openVideo</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (mUri == <span class="literal">null</span> || mSurfaceHolder == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// not ready for playback just yet, will try again later</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// we shouldn&#x27;t clear the target state, because somebody might have</span></span><br><span class="line">    <span class="comment">// called start() previously</span></span><br><span class="line">    release(<span class="literal">false</span>); <span class="comment">// 不改变状态地释放资源</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取音频管理器并请求获得音频焦点，销毁时需要释放焦点</span></span><br><span class="line">    <span class="type">AudioManager</span> <span class="variable">am</span> <span class="operator">=</span> (AudioManager) mContext.getSystemService(Context.AUDIO_SERVICE);</span><br><span class="line">    am.requestAudioFocus(<span class="literal">null</span>, AudioManager.STREAM_MUSIC, AudioManager.AUDIOFOCUS_GAIN);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        mMediaPlayer = <span class="keyword">new</span> <span class="title class_">MediaPlayer</span>();</span><br><span class="line">        <span class="comment">// 以下设置字幕相关的</span></span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> create SubtitleController in MediaPlayer, but we need</span></span><br><span class="line">        <span class="comment">// a context for the subtitle renderers</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> getContext();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">SubtitleController</span> <span class="variable">controller</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SubtitleController</span>(</span><br><span class="line">                context, mMediaPlayer.getMediaTimeProvider(), mMediaPlayer);</span><br><span class="line">        controller.registerRenderer(<span class="keyword">new</span> <span class="title class_">WebVttRenderer</span>(context));</span><br><span class="line">        controller.registerRenderer(<span class="keyword">new</span> <span class="title class_">TtmlRenderer</span>(context));</span><br><span class="line">        controller.registerRenderer(<span class="keyword">new</span> <span class="title class_">ClosedCaptionRenderer</span>(context));</span><br><span class="line">        mMediaPlayer.setSubtitleAnchor(controller, <span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置音频的SessionId</span></span><br><span class="line">        <span class="keyword">if</span> (mAudioSession != <span class="number">0</span>) &#123;</span><br><span class="line">            mMediaPlayer.setAudioSessionId(mAudioSession);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            mAudioSession = mMediaPlayer.getAudioSessionId();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置各监听器</span></span><br><span class="line">        mMediaPlayer.setOnPreparedListener(mPreparedListener);</span><br><span class="line">        mMediaPlayer.setOnVideoSizeChangedListener(mSizeChangedListener);</span><br><span class="line">        mMediaPlayer.setOnCompletionListener(mCompletionListener);</span><br><span class="line">        mMediaPlayer.setOnErrorListener(mErrorListener);</span><br><span class="line">        mMediaPlayer.setOnInfoListener(mInfoListener);</span><br><span class="line">        mMediaPlayer.setOnBufferingUpdateListener(mBufferingUpdateListener);</span><br><span class="line"></span><br><span class="line">        mCurrentBufferPercentage = <span class="number">0</span>; <span class="comment">// 缓冲进度为0</span></span><br><span class="line">        mMediaPlayer.setDataSource(mContext, mUri, mHeaders); <span class="comment">// 设置播放地址等参数</span></span><br><span class="line">        mMediaPlayer.setDisplay(mSurfaceHolder); <span class="comment">// 设置Surface持有者，用于绘制视频</span></span><br><span class="line">        mMediaPlayer.setAudioStreamType(AudioManager.STREAM_MUSIC); <span class="comment">// 设置音频流类型</span></span><br><span class="line">        mMediaPlayer.setScreenOnWhilePlaying(<span class="literal">true</span>); <span class="comment">// 设置当播放保持屏幕高亮</span></span><br><span class="line">        mMediaPlayer.prepareAsync(); <span class="comment">// 开始异步预处理</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加字幕流</span></span><br><span class="line">        <span class="keyword">for</span> (Pair&lt;InputStream, MediaFormat&gt; pending: mPendingSubtitleTracks) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                mMediaPlayer.addSubtitleSource(pending.first, pending.second);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalStateException e) &#123;</span><br><span class="line">                mInfoListener.onInfo(</span><br><span class="line">                        mMediaPlayer, MediaPlayer.MEDIA_INFO_UNSUPPORTED_SUBTITLE, <span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// we don&#x27;t set the target state here either, but preserve the</span></span><br><span class="line">        <span class="comment">// target state that was there before.</span></span><br><span class="line">        mCurrentState = STATE_PREPARING; <span class="comment">// 当前为预处理中状态</span></span><br><span class="line">        attachMediaController(); <span class="comment">// 添加控制器（若没有设置，则不添加）</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">        Log.w(TAG, <span class="string">&quot;Unable to open content: &quot;</span> + mUri, ex);</span><br><span class="line">        mCurrentState = STATE_ERROR;</span><br><span class="line">        mTargetState = STATE_ERROR;</span><br><span class="line">        mErrorListener.onError(mMediaPlayer, MediaPlayer.MEDIA_ERROR_UNKNOWN, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalArgumentException ex) &#123;</span><br><span class="line">        Log.w(TAG, <span class="string">&quot;Unable to open content: &quot;</span> + mUri, ex);</span><br><span class="line">        mCurrentState = STATE_ERROR;</span><br><span class="line">        mTargetState = STATE_ERROR;</span><br><span class="line">        mErrorListener.onError(mMediaPlayer, MediaPlayer.MEDIA_ERROR_UNKNOWN, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        mPendingSubtitleTracks.clear();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * release the media player in any state</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">release</span><span class="params">(<span class="type">boolean</span> cleartargetstate)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (mMediaPlayer != <span class="literal">null</span>) &#123;</span><br><span class="line">        mMediaPlayer.reset(); <span class="comment">// 重置播放器</span></span><br><span class="line">        mMediaPlayer.release(); <span class="comment">// 是否播放器</span></span><br><span class="line">        mMediaPlayer = <span class="literal">null</span>;</span><br><span class="line">        mPendingSubtitleTracks.clear(); <span class="comment">// 释放字幕</span></span><br><span class="line">        mCurrentState = STATE_IDLE; <span class="comment">// 当前状态为初始状态</span></span><br><span class="line">        <span class="keyword">if</span> (cleartargetstate) &#123; <span class="comment">// 需要清楚目标状态</span></span><br><span class="line">            mTargetState  = STATE_IDLE; <span class="comment">// 目标状态为初始状态</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">AudioManager</span> <span class="variable">am</span> <span class="operator">=</span> (AudioManager) mContext.getSystemService(Context.AUDIO_SERVICE);</span><br><span class="line">        am.abandonAudioFocus(<span class="literal">null</span>); <span class="comment">// 释放音频焦点</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="播放"><a href="#播放" class="headerlink" title="播放"></a>播放</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isInPlaybackState()) &#123; <span class="comment">// 播放器可以时</span></span><br><span class="line">        mMediaPlayer.start(); <span class="comment">// 开始播放</span></span><br><span class="line">        mCurrentState = STATE_PLAYING; <span class="comment">// 当前状态为播放状态</span></span><br><span class="line">    &#125;</span><br><span class="line">    mTargetState = STATE_PLAYING; <span class="comment">// 目标状态为播放状态</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="暂停"><a href="#暂停" class="headerlink" title="暂停"></a>暂停</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pause</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isInPlaybackState()) &#123; <span class="comment">// 播放器可以时</span></span><br><span class="line">        <span class="keyword">if</span> (mMediaPlayer.isPlaying()) &#123; <span class="comment">// 正在播放</span></span><br><span class="line">            mMediaPlayer.pause(); <span class="comment">// 暂停</span></span><br><span class="line">            mCurrentState = STATE_PAUSED; <span class="comment">// 当前状态为暂停状态</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    mTargetState = STATE_PAUSED; <span class="comment">// 目标状态为暂停状态</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="挂起播放器"><a href="#挂起播放器" class="headerlink" title="挂起播放器"></a>挂起播放器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 此方法一般在Activity进入onStop()状态时调用，不改变状态地释放资源</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">suspend</span><span class="params">()</span> &#123;</span><br><span class="line">    release(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="恢复播放器"><a href="#恢复播放器" class="headerlink" title="恢复播放器"></a>恢复播放器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 此方法一般在Activity从后台调到前台进入onResume()状态时调用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">resume</span><span class="params">()</span> &#123;</span><br><span class="line">    openVideo();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="其他方法"><a href="#其他方法" class="headerlink" title="其他方法"></a>其他方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">getDuration</span><span class="params">()</span> <span class="comment">// 获取时长</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">getCurrentPosition</span><span class="params">()</span> <span class="comment">// 获取当前播放进度</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">seekTo</span><span class="params">(<span class="type">int</span> msec)</span> <span class="comment">// 跳转到指定位置</span></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">isPlaying</span><span class="params">()</span> <span class="comment">// 视频是否在播放</span></span><br><span class="line">getBufferPercentage() <span class="comment">// 获取缓冲百分比</span></span><br></pre></td></tr></table></figure>
<p>其他 控制器UI加入 及 字幕相关 等方法就不一一分析了。可以自行查看<a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/widget/VideoView">VideoView源码</a></p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2022-06-01T06:28:52.493Z" itemprop="dateUpdated">2022-06-01 14:28:52</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="http://hezhubo.github.io">
            <img src="/img/avatar.jpg" alt="Hezb">
            Hezb
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/videoview/" rel="tag">videoview</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%A4%9A%E5%AA%92%E4%BD%93/" rel="tag">多媒体</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%9F%B3%E8%A7%86%E9%A2%91/" rel="tag">音视频</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://hezhubo.github.io/2016/08/28/android-videoview/&title=《android多媒体播放器之VideoView》 — Hezb's blog&pic=http://hezhubo.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://hezhubo.github.io/2016/08/28/android-videoview/&title=《android多媒体播放器之VideoView》 — Hezb's blog&source=人的梦想是不会结束的~~~" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://hezhubo.github.io/2016/08/28/android-videoview/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《android多媒体播放器之VideoView》 — Hezb's blog&url=http://hezhubo.github.io/2016/08/28/android-videoview/&via=http://hezhubo.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://hezhubo.github.io/2016/08/28/android-videoview/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2022/06/02/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">音视频基础知识</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2016/08/27/android-mediaplayer/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">android多媒体播放器之MediaPlayer</h4>
      </a>
    </div>
  
</nav>



    




















</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        感谢投喂
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpeg" alt="打赏二维码">
        </div>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license noopener" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Hezb &copy; 2015 - 2022</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://hezhubo.github.io/2016/08/28/android-videoview/&title=《android多媒体播放器之VideoView》 — Hezb's blog&pic=http://hezhubo.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://hezhubo.github.io/2016/08/28/android-videoview/&title=《android多媒体播放器之VideoView》 — Hezb's blog&source=人的梦想是不会结束的~~~" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://hezhubo.github.io/2016/08/28/android-videoview/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《android多媒体播放器之VideoView》 — Hezb's blog&url=http://hezhubo.github.io/2016/08/28/android-videoview/&via=http://hezhubo.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://hezhubo.github.io/2016/08/28/android-videoview/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://hezhubo.github.io/2016/08/28/android-videoview/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.js?v=1.7.2" async></script>










</body>
</html>
