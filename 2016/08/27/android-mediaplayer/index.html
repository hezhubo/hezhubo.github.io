<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>android多媒体播放器之MediaPlayer | Hezb&#39;s blog | android程序猿</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="音视频,多媒体,mediaplayer">
    <meta name="description" content="废话少说，先上一张无比重要的图：MediaPlayer状态图，读懂此图那后面的都是废话了。                                                                                              android官方MediaPlayer状态图               MediaPlayer的简单使用1234567">
<meta property="og:type" content="article">
<meta property="og:title" content="android多媒体播放器之MediaPlayer">
<meta property="og:url" content="http://hezhubo.github.io/2016/08/27/android-mediaplayer/index.html">
<meta property="og:site_name" content="Hezb&#39;s blog">
<meta property="og:description" content="废话少说，先上一张无比重要的图：MediaPlayer状态图，读懂此图那后面的都是废话了。                                                                                              android官方MediaPlayer状态图               MediaPlayer的简单使用1234567">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://developer.android.google.cn/images/mediaplayer_state_diagram.gif?hl=zh-cn">
<meta property="article:published_time" content="2016-08-27T12:24:15.000Z">
<meta property="article:modified_time" content="2022-06-01T06:44:44.727Z">
<meta property="article:author" content="Hezb">
<meta property="article:tag" content="音视频">
<meta property="article:tag" content="多媒体">
<meta property="article:tag" content="mediaplayer">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://developer.android.google.cn/images/mediaplayer_state_diagram.gif?hl=zh-cn">
    
        <link rel="alternate" type="application/atom+xml" title="Hezb&#39;s blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.7.2">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 6.2.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Hezb</h5>
          <a href="mailto:526125686@qq.com" title="526125686@qq.com" class="mail">526125686@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/hezhubo" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">android多媒体播放器之MediaPlayer</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">android多媒体播放器之MediaPlayer</h1>
        <h5 class="subtitle">
            
                <time datetime="2016-08-27T12:24:15.000Z" itemprop="datePublished" class="page-time">
  2016-08-27
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/">Android</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#MediaPlayer%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8"><span class="post-toc-text">MediaPlayer的简单使用</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#MediaPlayer%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%96%B9%E6%B3%95%E8%AF%B4%E6%98%8E"><span class="post-toc-text">MediaPlayer的基本方法说明</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E5%88%9B%E5%BB%BAMediaPlayer%E5%AF%B9%E8%B1%A1"><span class="post-toc-text">创建MediaPlayer对象</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E8%AE%BE%E7%BD%AEMediaPlayer%E7%9A%84%E5%90%84%E7%A7%8D%E7%9B%91%E5%90%AC%E5%99%A8"><span class="post-toc-text">设置MediaPlayer的各种监听器</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#MediaPlayer%E7%9A%84%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95"><span class="post-toc-text">MediaPlayer的操作方法</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#%E8%AE%BE%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%85%83"><span class="post-toc-text">设置数据元</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#%E9%A2%84%E5%A4%84%E7%90%86-%E5%8A%A0%E8%BD%BD-%E5%A4%9A%E5%AA%92%E4%BD%93%E6%95%B0%E6%8D%AE"><span class="post-toc-text">预处理(加载)多媒体数据</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#%E5%BC%80%E5%A7%8B%E6%92%AD%E6%94%BE"><span class="post-toc-text">开始播放</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#%E6%9A%82%E5%81%9C%E6%92%AD%E6%94%BE"><span class="post-toc-text">暂停播放</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#%E8%B7%B3%E8%BD%AC%E5%88%B0%E6%8C%87%E5%AE%9A%E4%BD%8D%E7%BD%AE"><span class="post-toc-text">跳转到指定位置</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%92%AD%E6%94%BE%E4%BD%8D%E7%BD%AE"><span class="post-toc-text">获取当前播放位置</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E6%80%BB%E6%97%B6%E9%95%BF"><span class="post-toc-text">获取当前总时长</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#%E5%81%9C%E6%AD%A2%E6%92%AD%E6%94%BE"><span class="post-toc-text">停止播放</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#%E9%87%8D%E7%BD%AE%E6%92%AD%E6%94%BE%E5%99%A8"><span class="post-toc-text">重置播放器</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#%E9%87%8A%E6%94%BE%E8%B5%84%E6%BA%90"><span class="post-toc-text">释放资源</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%A7%86%E9%A2%91%E7%94%BB%E9%9D%A2%E8%BE%93%E5%87%BA"><span class="post-toc-text">设置视频画面输出</span></a></li><li class="post-toc-item post-toc-level-6"><a class="post-toc-link" href="#%E8%8E%B7%E5%8F%96%E8%A7%86%E9%A2%91%E5%AE%BD%E9%AB%98"><span class="post-toc-text">获取视频宽高</span></a></li></ol></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-android-mediaplayer"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">android多媒体播放器之MediaPlayer</h1>
        <div class="post-meta">
            <time class="post-time" title="2016-08-27 20:24:15" datetime="2016-08-27T12:24:15.000Z"  itemprop="datePublished">2016-08-27</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Android/">Android</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p><strong>废话少说，先上一张无比重要的图：MediaPlayer状态图，读懂此图那后面的都是废话了。</strong></p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://developer.android.google.cn/images/mediaplayer_state_diagram.gif?hl=zh-cn" alt="android官方MediaPlayer状态图" title="">
                </div>
                <div class="image-caption">android官方MediaPlayer状态图</div>
            </figure>

<h4 id="MediaPlayer的简单使用"><a href="#MediaPlayer的简单使用" class="headerlink" title="MediaPlayer的简单使用"></a>MediaPlayer的简单使用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">MediaPlayer</span> <span class="variable">mediaPlayer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MediaPlayer</span>();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    mediaPlayer.setDataSource(<span class="string">&quot;/mnt/sdcard/test.mp3&quot;</span>); <span class="comment">// 设置多媒体文件路径，支持本地文件，http，rtsp协议</span></span><br><span class="line">    mediaPlayer.prepare(); <span class="comment">// 以同步(阻塞)方式，预处理（加载）多媒体文件，此方法一般用于本地文件 </span></span><br><span class="line">    mediaPlayer.start(); <span class="comment">// 开始播放</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="MediaPlayer的基本方法说明"><a href="#MediaPlayer的基本方法说明" class="headerlink" title="MediaPlayer的基本方法说明"></a>MediaPlayer的基本方法说明</h4><h5 id="创建MediaPlayer对象"><a href="#创建MediaPlayer对象" class="headerlink" title="创建MediaPlayer对象"></a>创建MediaPlayer对象</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基本的构造方法</span></span><br><span class="line"><span class="type">MediaPlayer</span> <span class="variable">mediaPlayer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MediaPlayer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 静态的构造方法</span></span><br><span class="line">Context context; <span class="comment">// 上下文</span></span><br><span class="line">Uri uri; <span class="comment">// 多媒体文件的URI</span></span><br><span class="line">SurfaceHolder holder; <span class="comment">// surface持有者，用于视频画面输出</span></span><br><span class="line">AudioAttributes audioAttributes; <span class="comment">// 封装音频流信息的属性集合类</span></span><br><span class="line"><span class="type">int</span> audioSessionId; <span class="comment">// 音频的Session Id</span></span><br><span class="line"><span class="type">int</span> resid; <span class="comment">// 多媒体资源Id</span></span><br><span class="line"><span class="type">MediaPlayer</span> <span class="variable">mediaPlayer</span> <span class="operator">=</span> MediaPlayer.create(context, uri);</span><br><span class="line"><span class="type">MediaPlayer</span> <span class="variable">mediaPlayer</span> <span class="operator">=</span> MediaPlayer.create(context, uri, holder);</span><br><span class="line"><span class="type">MediaPlayer</span> <span class="variable">mediaPlayer</span> <span class="operator">=</span> MediaPlayer.create(context, uri, holder, audioAttributes, audioSessionId);</span><br><span class="line"><span class="type">MediaPlayer</span> <span class="variable">mediaPlayer</span> <span class="operator">=</span> MediaPlayer.create(context, resid);</span><br><span class="line"><span class="type">MediaPlayer</span> <span class="variable">mediaPlayer</span> <span class="operator">=</span> MediaPlayer.create(context, resid, audioAttributes, audioSessionId);</span><br></pre></td></tr></table></figure>

<h5 id="设置MediaPlayer的各种监听器"><a href="#设置MediaPlayer的各种监听器" class="headerlink" title="设置MediaPlayer的各种监听器"></a>设置MediaPlayer的各种监听器</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 预处理监听器</span></span><br><span class="line">mediaPlayer.setOnPreparedListener(<span class="keyword">new</span> <span class="title class_">MediaPlayer</span>.OnPreparedListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onPrepared</span><span class="params">(MediaPlayer mp)</span> &#123;</span><br><span class="line">        <span class="comment">// 在MediaPlayer完成加载多媒体文件时回调此方法</span></span><br><span class="line">        <span class="comment">// 此时可以获取多媒体文件信息（如视频宽高，时长等）</span></span><br><span class="line">        <span class="comment">// 可以开始执行播放</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 播放完成监听器</span></span><br><span class="line">mediaPlayer.setOnCompletionListener(<span class="keyword">new</span> <span class="title class_">MediaPlayer</span>.OnCompletionListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCompletion</span><span class="params">(MediaPlayer mp)</span> &#123;</span><br><span class="line">        <span class="comment">// 在MediaPlayer播放完成时回调此方法</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 播放出错监听器</span></span><br><span class="line">mediaPlayer.setOnErrorListener(<span class="keyword">new</span> <span class="title class_">MediaPlayer</span>.OnErrorListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onError</span><span class="params">(MediaPlayer mp, <span class="type">int</span> what, <span class="type">int</span> extra)</span> &#123;</span><br><span class="line">        <span class="comment">// 使用播放器过程中出现错误会回调此方法</span></span><br><span class="line">        <span class="comment">// what 发生的错误类型, extra 具体的错误代码</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 播放过程中部分信息监听器</span></span><br><span class="line">mediaPlayer.setOnInfoListener(<span class="keyword">new</span> <span class="title class_">MediaPlayer</span>.OnInfoListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onInfo</span><span class="params">(MediaPlayer mp, <span class="type">int</span> what, <span class="type">int</span> extra)</span> &#123;</span><br><span class="line">        <span class="comment">// 在播放器播放过程中部分状态信息会回调此方法</span></span><br><span class="line">        <span class="comment">// what 信息或警告的类型, extra 具体的信息代码</span></span><br><span class="line">        <span class="comment">// 如 what: MEDIA_INFO_BUFFERING_START 开始缓冲</span></span><br><span class="line">        <span class="comment">// MEDIA_INFO_BUFFERING_END 缓冲完成</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 视频尺寸变化监听器</span></span><br><span class="line">mediaPlayer.setOnVideoSizeChangedListener(<span class="keyword">new</span> <span class="title class_">MediaPlayer</span>.OnVideoSizeChangedListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onVideoSizeChanged</span><span class="params">(MediaPlayer mp, <span class="type">int</span> width, <span class="type">int</span> height)</span> &#123;</span><br><span class="line">        <span class="comment">// 在播放视频时视频宽高发生变化回调此方法</span></span><br><span class="line">        <span class="comment">// 此时一般会去处理视频输出的View的宽高布局</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 缓冲进度更新监听器</span></span><br><span class="line">mediaPlayer.setOnBufferingUpdateListener(<span class="keyword">new</span> <span class="title class_">MediaPlayer</span>.OnBufferingUpdateListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onBufferingUpdate</span><span class="params">(MediaPlayer mp, <span class="type">int</span> percent)</span> &#123;</span><br><span class="line">        <span class="comment">// 在缓冲进度改变时会回调此方法</span></span><br><span class="line">        <span class="comment">// percent 缓冲百分比</span></span><br><span class="line">        <span class="comment">// 一般用于更新进度条的第二进度</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 播放跳转完成监听器</span></span><br><span class="line">mediaPlayer.setOnSeekCompleteListener(<span class="keyword">new</span> <span class="title class_">MediaPlayer</span>.OnSeekCompleteListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSeekComplete</span><span class="params">(MediaPlayer mp)</span> &#123;</span><br><span class="line">        <span class="comment">// 在调用seekTo()，跳转完成后会回调此方法</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 字幕监听器</span></span><br><span class="line">mediaPlayer.setOnTimedTextListener(<span class="keyword">new</span> <span class="title class_">MediaPlayer</span>.OnTimedTextListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onTimedText</span><span class="params">(MediaPlayer mp, TimedText text)</span> &#123;</span><br><span class="line">        <span class="comment">// 当有字幕需要显示时会回调此方法</span></span><br><span class="line">        <span class="comment">// text 包含字幕内容，格式</span></span><br><span class="line">        <span class="comment">// 我暂时没有用过此监听器</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// API23 媒体数据可用监听器</span></span><br><span class="line">mediaPlayer.setOnTimedMetaDataAvailableListener(<span class="keyword">new</span> <span class="title class_">MediaPlayer</span>.OnTimedMetaDataAvailableListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onTimedMetaDataAvailable</span><span class="params">(MediaPlayer mp, TimedMetaData data)</span> &#123;</span><br><span class="line">        <span class="comment">// 当有可用的元数据时回调此方法</span></span><br><span class="line">        <span class="comment">// data 数据元，包含时间戳</span></span><br><span class="line">        <span class="comment">// 我暂时没有用过此监听器，我猜想可以用此回调来实现边看边缓存视频</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="MediaPlayer的操作方法"><a href="#MediaPlayer的操作方法" class="headerlink" title="MediaPlayer的操作方法"></a>MediaPlayer的操作方法</h5><h6 id="设置数据元"><a href="#设置数据元" class="headerlink" title="设置数据元"></a>设置数据元</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Context context; <span class="comment">// 上下文</span></span><br><span class="line">Uri uri; <span class="comment">// 多媒体文件的URI</span></span><br><span class="line">Map&lt;String, String&gt; headers; <span class="comment">// http的请求头</span></span><br><span class="line">String path; <span class="comment">// 多媒体路径，支持本地文件，http，rtsp协议</span></span><br><span class="line">FileDescriptor fd; <span class="comment">// 多媒体文件描述符，可通过AssetManager去构建</span></span><br><span class="line"><span class="type">long</span> offset; <span class="comment">// 以字节为单位的数据偏移量</span></span><br><span class="line"><span class="type">long</span> length; <span class="comment">// 要播放的数据字节长度</span></span><br><span class="line">MediaDataSource dataSource; <span class="comment">// 为framework层提供媒体数据的类</span></span><br><span class="line">mediaPlayer.setDataSource(context, uri);</span><br><span class="line">mediaPlayer.setDataSource(context, uri, headers); <span class="comment">// 暂时没用过</span></span><br><span class="line">mediaPlayer.setDataSource(path);</span><br><span class="line">mediaPlayer.setDataSource(fd);</span><br><span class="line">mediaPlayer.setDataSource(fd, offset, length); <span class="comment">// 暂时没用过</span></span><br><span class="line">mediaPlayer.setDataSource(dataSource); <span class="comment">// 暂时没用过</span></span><br></pre></td></tr></table></figure>
<h6 id="预处理-加载-多媒体数据"><a href="#预处理-加载-多媒体数据" class="headerlink" title="预处理(加载)多媒体数据"></a>预处理(加载)多媒体数据</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mediaPlayer.prepare(); <span class="comment">// 会阻塞当前线程</span></span><br><span class="line">mediaPlayer.prepareAsync(); <span class="comment">// 异步加载</span></span><br></pre></td></tr></table></figure>
<h6 id="开始播放"><a href="#开始播放" class="headerlink" title="开始播放"></a>开始播放</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mediaPlayer.start(); <span class="comment">// 需要在预处理完成后才会起作用</span></span><br></pre></td></tr></table></figure>
<h6 id="暂停播放"><a href="#暂停播放" class="headerlink" title="暂停播放"></a>暂停播放</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mediaPlayer.pause(); <span class="comment">// 需要在预处理完成后才会起作用</span></span><br></pre></td></tr></table></figure>
<h6 id="跳转到指定位置"><a href="#跳转到指定位置" class="headerlink" title="跳转到指定位置"></a>跳转到指定位置</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> msec; <span class="comment">// 跳转位置（单位毫秒） 取值要大于0，小于视频总时长</span></span><br><span class="line">mediaPlayer.seekTo(msec); <span class="comment">// 需要在预处理完成后才会起作用</span></span><br></pre></td></tr></table></figure>
<h6 id="获取当前播放位置"><a href="#获取当前播放位置" class="headerlink" title="获取当前播放位置"></a>获取当前播放位置</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">currentPosition</span> <span class="operator">=</span> mediaPlayer.getCurrentPosition(); <span class="comment">// 需要在预处理完成后才会起作用</span></span><br></pre></td></tr></table></figure>
<h6 id="获取当前总时长"><a href="#获取当前总时长" class="headerlink" title="获取当前总时长"></a>获取当前总时长</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">duration</span> <span class="operator">=</span> mediaPlayer.getDuration(); <span class="comment">// 需要在预处理完成后才会起作用</span></span><br></pre></td></tr></table></figure>
<h6 id="停止播放"><a href="#停止播放" class="headerlink" title="停止播放"></a>停止播放</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mediaPlayer.stop(); <span class="comment">// 需要在预处理完成后才会起作用，若想继续播放，需要重新加载多媒体文件</span></span><br></pre></td></tr></table></figure>
<h6 id="重置播放器"><a href="#重置播放器" class="headerlink" title="重置播放器"></a>重置播放器</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mediaPlayer.reset(); <span class="comment">// 重置mediaPlayer为最初状态，再次使用需要重新设置多媒体路径</span></span><br></pre></td></tr></table></figure>
<h6 id="释放资源"><a href="#释放资源" class="headerlink" title="释放资源"></a>释放资源</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mediaPlayer.release(); <span class="comment">// 释放与mediaPlayer对象关联的所有资源</span></span><br></pre></td></tr></table></figure>
<h6 id="设置视频画面输出"><a href="#设置视频画面输出" class="headerlink" title="设置视频画面输出"></a>设置视频画面输出</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过SurfaceView来显示视频</span></span><br><span class="line">SurfaceView surfaceView; <span class="comment">// 通过xml资源或是使用代码自行创建</span></span><br><span class="line"><span class="comment">// 需要给surface持有者添加监听器</span></span><br><span class="line">surfaceView.getHolder().addCallback(<span class="keyword">new</span> <span class="title class_">SurfaceHolder</span>.Callback() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">surfaceCreated</span><span class="params">(SurfaceHolder holder)</span> &#123;</span><br><span class="line">        <span class="comment">// surfaceView成功创建，此时holder才可用</span></span><br><span class="line">        mediaPlayer.setDisplay(holder);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">surfaceChanged</span><span class="params">(SurfaceHolder holder, <span class="type">int</span> format, <span class="type">int</span> width, <span class="type">int</span> height)</span> &#123;</span><br><span class="line">        <span class="comment">// surface发生改变时</span></span><br><span class="line">        <span class="comment">// format 格式， width 宽， height 高</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">surfaceDestroyed</span><span class="params">(SurfaceHolder holder)</span> &#123;</span><br><span class="line">        <span class="comment">// surfaceView销毁时</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过TextureView来显示视频</span></span><br><span class="line">TextureView textureView; <span class="comment">// 通过xml资源或是使用代码自行创建</span></span><br><span class="line">textureView.setSurfaceTextureListener(<span class="keyword">new</span> <span class="title class_">TextureView</span>.SurfaceTextureListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSurfaceTextureAvailable</span><span class="params">(SurfaceTexture surface, <span class="type">int</span> width, <span class="type">int</span> height)</span> &#123;</span><br><span class="line">        <span class="comment">// 当SurfaceTexture可用时</span></span><br><span class="line">        <span class="comment">// width 纹理宽， height 纹理高</span></span><br><span class="line">        <span class="type">Surface</span> <span class="variable">displaySurface</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Surface</span>(surface); <span class="comment">// 通过SurfaceTexture来构建Surface </span></span><br><span class="line">        mediaPlayer.setSurface(displaySurface);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSurfaceTextureSizeChanged</span><span class="params">(SurfaceTexture surface, <span class="type">int</span> width, <span class="type">int</span> height)</span> &#123;</span><br><span class="line">        <span class="comment">// 纹理尺寸发生改变时</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onSurfaceTextureDestroyed</span><span class="params">(SurfaceTexture surface)</span> &#123;</span><br><span class="line">        <span class="comment">// textureView销毁时</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onSurfaceTextureUpdated</span><span class="params">(SurfaceTexture surface)</span> &#123;</span><br><span class="line">        <span class="comment">// textureView重新设置了SurfaceTexture</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h6 id="获取视频宽高"><a href="#获取视频宽高" class="headerlink" title="获取视频宽高"></a>获取视频宽高</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">width</span> <span class="operator">=</span> mediaPlayer.getVideoWidth(); <span class="comment">// 需要在预处理完成后才会起作用</span></span><br><span class="line"><span class="type">int</span> <span class="variable">height</span> <span class="operator">=</span> mediaPlayer.getVideoHeight(); <span class="comment">// 需要在预处理完成后才会起作用</span></span><br></pre></td></tr></table></figure>
<p>其他方法就不一一列出了，可以自行查看<a target="_blank" rel="noopener" href="https://developer.android.google.cn/reference/android/media/MediaPlayer">MediaPlayer源码</a></p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2022-06-01T06:44:44.727Z" itemprop="dateUpdated">2022-06-01 14:44:44</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="http://hezhubo.github.io">
            <img src="/img/avatar.jpg" alt="Hezb">
            Hezb
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mediaplayer/" rel="tag">mediaplayer</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%A4%9A%E5%AA%92%E4%BD%93/" rel="tag">多媒体</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%9F%B3%E8%A7%86%E9%A2%91/" rel="tag">音视频</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://hezhubo.github.io/2016/08/27/android-mediaplayer/&title=《android多媒体播放器之MediaPlayer》 — Hezb's blog&pic=http://hezhubo.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://hezhubo.github.io/2016/08/27/android-mediaplayer/&title=《android多媒体播放器之MediaPlayer》 — Hezb's blog&source=人的梦想是不会结束的~~~" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://hezhubo.github.io/2016/08/27/android-mediaplayer/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《android多媒体播放器之MediaPlayer》 — Hezb's blog&url=http://hezhubo.github.io/2016/08/27/android-mediaplayer/&via=http://hezhubo.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://hezhubo.github.io/2016/08/27/android-mediaplayer/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2016/08/28/android-videoview/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">android多媒体播放器之VideoView</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2016/07/06/android-adb-command/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">ADB常用命令</h4>
      </a>
    </div>
  
</nav>



    




















</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        感谢投喂
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpeg" alt="打赏二维码">
        </div>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license noopener" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Hezb &copy; 2015 - 2022</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://hezhubo.github.io/2016/08/27/android-mediaplayer/&title=《android多媒体播放器之MediaPlayer》 — Hezb's blog&pic=http://hezhubo.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://hezhubo.github.io/2016/08/27/android-mediaplayer/&title=《android多媒体播放器之MediaPlayer》 — Hezb's blog&source=人的梦想是不会结束的~~~" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://hezhubo.github.io/2016/08/27/android-mediaplayer/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《android多媒体播放器之MediaPlayer》 — Hezb's blog&url=http://hezhubo.github.io/2016/08/27/android-mediaplayer/&via=http://hezhubo.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://hezhubo.github.io/2016/08/27/android-mediaplayer/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://hezhubo.github.io/2016/08/27/android-mediaplayer/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.js?v=1.7.2"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.js?v=1.7.2" async></script>










</body>
</html>
